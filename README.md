**TreeVada** is a grammar inference tool, based on the prior work [Arvada](https://github.com/neil-kulkarni/arvada).
## Building

Requires at least python 3.7. Install the following two packages via pip to make sure everything runs:
```
$ pip3 install lark-parser
$ pip3 install tqdm
```

## Running TreeVada

Suppose you have a directory containing a set of examples, `TRAIN_DIR`, and an oracle for a valid example, `ORACLE_CMD`. The restrictions on `ORACLE_CMD` are as follows:

- `ORACLE_CMD filename` should run the oracle on the file with name `filename`
- `ORACLE_CMD filename` should return 0 if the example in `filename` is valid, and an exit code greater than 0 if it is invalid. 

You can then run Arvada via:
```
$ python3 search.py external ORACLE_CMD TRAIN_DIR LOG_FILE
```
this will store the learned grammar as a pickled dictionary in `LOG_FILE.gramdict`, and some information about training in `LOG_FILE`.

If you also have a held-out test set in `TEST_DIR`, you can evaluate the precision and recall of the mined grammar with the utility `eval.py`. This utility also handily prints out the unpickled grammar. The provided `LOG_FILE` must match one generated by search.py, as this utility looks for `LOG_FILE.gramdict`. 
```
$ python3 eval.py external [-n PRECISION_SET_SIZE] ORACLE_CMD TEST_DIR LOG_FILE
```
The optional `PRECISION_SET_SIZE` argument specifies how many inputs to sample from the mined grammar to evaluate precision. It is 1000 by default.

Of course, if you do not have a held-out test set, you can still evaluate the precision of the mined grammar by using your training directory as test:
```
$ python3 eval.py external [-n PRECISION_SET_SIZE] ORACLE_CMD TRAIN_DIR LOG_FILE
```
The Recall should be 1.0 in this case.


## Reproducing the Ablation Studies

Switch to the specific branch for a particular study

| Description      | Branch |
| :---        |    ----:   |
| Arvada replication (without parser timeout)      | ``replication``       |
| Deterministic version of Arvada   | `deterministic-replication`|
| Re-apply learned rules   | `reapply-deterministic` |
| Initial bracket-based trees   | `tree-all-bubble` |
| No partial merge   | `reapply-tree` |




